{{ define "main" }}
  <div class="poems-container">
    <!-- Left Panel: Poem List -->
    <div class="poems-left">
      <div class="poems-header">
        <h1>{{ .Title }}</h1>
      </div>

      <div class="poems-gallery">
        {{ $poems := sort (where .Site.RegularPages "Section" "runot") "Date" "desc" }}
        {{ range $index, $poem := $poems }}
          <div class="poem-card" data-poem-id="poem-{{ $index }}">
            <div class="poem-header">
              <h2>{{ $poem.Title }}</h2>
            </div>

            <div class="poem-excerpt">
              {{ if in $poem.RawContent "<!--more-->" }}
                {{ $parts := split $poem.RawContent "<!--more-->" }}
                {{ index $parts 0 | safeHTML }}
              {{ else }}
                {{ $poem.Summary | truncate 200 | safeHTML }}
              {{ end }}
            </div>

            <button class="expand-btn" onclick="expandPoem(this, 'poem-{{ $index }}', '{{ $poem.Title }}')">Lue kokonaan →</button>

            <div class="poem-full-content hidden">
              {{ $poem.Content }}
            </div>
          </div>
        {{ end }}
      </div>
    </div>

    <!-- Divider -->
    <div class="poems-divider"></div>

    <!-- Right Panel: Full Poem Content (Desktop) -->
    <div class="poems-right">
      <div class="poem-full-content-wrapper" id="fullContentWrapper">
        <div class="empty-state">
          <p>Valitse runo lukeaksesi sen kokonaan</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Popup (Mobile) -->
  <div class="poem-modal" id="poemModal">
    <div class="poem-modal-content">
      <button class="modal-close" onclick="closeModal()">✕</button>
      <div class="poem-modal-body" id="modalBody">
        <div class="empty-state">
          <p>Valitse runo lukeaksesi sen kokonaan</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    function expandPoem(button, poemId, title) {
      const card = button.closest('.poem-card');
      const fullContent = card.querySelector('.poem-full-content');
      const wrapper = document.getElementById('fullContentWrapper');
      const modalBody = document.getElementById('modalBody');
      const modal = document.getElementById('poemModal');

      // Highlight active card
      document.querySelectorAll('.poem-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');

      const contentHTML = `
        <div class="poem-full-display">
          <h2>${title}</h2>
          <div class="poem-full-text">
            ${fullContent.innerHTML}
          </div>
        </div>
      `;

      // Check if mobile
      if (window.innerWidth <= 768) {
        modalBody.innerHTML = contentHTML;
        modal.classList.add('active');
      } else {
        wrapper.innerHTML = contentHTML;
      }
    }

    function closeModal() {
      const modal = document.getElementById('poemModal');
      modal.classList.remove('active');
    }

    // Close modal when clicking outside
    document.getElementById('poemModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });
  </script>
{{ end }}
