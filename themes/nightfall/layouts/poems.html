{{ define "main" }}
  <div class="content">
    {{ .Content }}
  </div>

  <div class="poems-header">
    <h1>{{ .Title }}</h1>
  </div>

  {{ $poems := sort (where .Site.RegularPages "Section" "runot") "Date" "desc" }}

  <div class="poems-gallery">
    {{ range $poems }}
      <div class="poem-card">
        <div class="poem-header">
          <h2>{{ .Title }}</h2>
        </div>

        <div class="poem-excerpt">
          {{ if in .RawContent "<!--more-->" }}
            {{ $parts := split .RawContent "<!--more-->" }}
            {{ index $parts 0 | safeHTML }}
          {{ else }}
            {{ .Summary | truncate 200 | safeHTML }}
          {{ end }}
        </div>

        <div class="poem-full-content hidden">
          {{ .Content }}
        </div>

        <button class="expand-btn" onclick="expandPoem(this)">Lue kokonaan →</button>
      </div>
    {{ end }}
  </div>

  <script>
    function expandPoem(button) {
      const card = button.closest('.poem-card');
      const excerpt = card.querySelector('.poem-excerpt');
      const fullContent = card.querySelector('.poem-full-content');

      if (fullContent.classList.contains('hidden')) {
        excerpt.classList.add('hidden');
        fullContent.classList.remove('hidden');
        button.textContent = '← Palauta';
      } else {
        fullContent.classList.add('hidden');
        excerpt.classList.remove('hidden');
        button.textContent = 'Lue kokonaan →';
      }
    }
  </script>
{{ end }}
